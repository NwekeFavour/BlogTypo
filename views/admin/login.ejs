<form  id="loginForm" action="/login" method="POST">
    <div class="w-75 mx-auto my-4">
        <div>
            <h2>Login</h2>
        </div>
        <div class="form-floating mb-3">
            <input type="text" class="form-control" id="validationServerUsername"
            aria-describedby="inputGroupPrepend3 validationServerUsernameFeedback" name="username" required>            
            <label for="floatingInput">Username</label>
        </div>
        <div class="form-floating">
            <input type="password" class="form-control" id="floatingPassword" name="password" placeholder="Password" required>
            <label for="floatingPassword">Password</label>
        </div>
        <div class="d-flex align-items-center justify-content-center my-4">
            <button class="btn btn-lg btn-outline-primary">login</button>
        </div>
        <div id="errorMessage" class="text-danger"></div>
    </div>
</form>
<script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            const result = await response.json();
            if (response.ok) {
                // Redirect without adding to history
                window.location.replace(result.redirectUrl);
            } else {
                document.getElementById('errorMessage').textContent = result.message;
            }
        } catch (error) {
            console.error('An error occurred:', error);
            document.getElementById('errorMessage').textContent = 'An error occurred';
        }
    });
    
</script>